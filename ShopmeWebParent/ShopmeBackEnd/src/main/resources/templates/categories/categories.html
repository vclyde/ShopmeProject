<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head th:replace="~{layout :: page_head('Categories - Shopme Admin')}"></head>
	<body>
		<div
			style="position: relative; min-height: 100vh; min-height: 100dvh; min-height: 100svh; min-height: 100lvh; padding-bottom: 70px;">
			<div th:replace="~{layout :: menu}"></div>
			<div class="container-fluid">
				<div>
					<h2>Manage Categories</h2>
					<a th:href="@{/categories/new}" class="bi bi-bag-plus link-secondary h3 me-1" title="Create new category"></a>
					<a th:href="@{/categories/export/csv}" class="bi bi-filetype-csv link-secondary h3 me-1" title="Export to CSV"></a>
					<!--  <a th:href="@{/categories/export/excel}" class="bi bi-file-earmark-excel-fill link-secondary h3 me-1"
						title="Export to Excel"></a>
					<a th:href="@{/categories/export/pdf}" class="bi bi-file-earmark-pdf-fill link-secondary h3" title="Export to PDF"></a>
					-->
				</div>
				<div th:if="${message != null}" class="alert alert-success text-center my-2" role="alert">[[${message}]]</div>
				<div class="m-3">
					<form th:action="@{/categories/page/1}" class="row g-2">
						<input type="hidden" name="sortField" th:value="${sortField}">
						<input type="hidden" name="sortDir" th:value="${sortDir}">
						<div class="col-auto">
							<label class="col-form-label">Filter: </label>
						</div>
						<div class="col-auto">
							<input type="search" class="form-control" name="keyword" th:value="${keyword}" required>
						</div>
						<div class="col-auto">
							<button class="btn btn-primary me-1" type="submit" title="Search">
								<i class="bi bi-search"></i>
							</button>
							<button class="btn btn-secondary" type="reset" title="Clear" onclick="clearFilter()">
								<i class="bi bi-x-lg"></i>
							</button>
						</div>
					</form>
				</div>
				<div class="full-details table-responsive">
					<table class="table table-bordered table-hover">
						<thead class="table-primary">
							<tr>
								<th>ID</th>
								<th>Category Image</th>
								<th>Category Name</th>
								<th>Alias</th>
								<th>Enabled</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="cat : ${listCategories}">
								<td>[[${cat.id}]]</td>
								<td class="text-center">
									<i th:if="${cat.image == '' or cat.image == 'default.png'}" class="bi bi-card-image h1"></i>
									<img th:if="${cat.image != ''}" th:src="@{${cat.categoryImage}}" class="img" >
								</td>
								<td>[[${cat.name}]]</td>
								<td>[[${cat.alias}]]</td>
								<td class="text-center">
									<a th:if="${cat.enabled == true}" class="bi bi-check-circle-fill h4 icon-green"
									   th:href="@{'/categories/' + ${cat.id} + '/enabled/false'}" title="Click to disable category"></a>
									<a th:if="${cat.enabled == false}" class="bi bi-check-circle-fill h4 icon-gray"
									   th:href="@{'/categories/' + ${cat.id} + '/enabled/true'}" title="Click to enable category"></a>
								</td>
								<td>
									<a class="bi bi-pencil-square h4 icon-green" th:href="@{'/categories/edit/' + ${cat.id}}"
									   title="Edit this category"></a>
									<a class="bi bi-trash h4 icon-gray link-delete" th:href="@{'/categories/delete/' + ${cat.id}}"
									   th:catId="${cat.id}" title="Delete this category"></a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="text-center m-1" th:if="${totalItems > 0}">
					<span>Showing category # [[${startCount}]] to [[${endCount}]] of [[${totalItems}]]</span>
				</div>
				<div class="text-center m-1" th:unless="${totalItems > 0}">
					<span>No categories found!</span>
				</div>
				<div th:if="${totalPages > 1}">
					<nav>
						<ul class="pagination justify-content-center my-2 flex-wrap">
							<li th:class="${currentPage == 1} ? 'page-item disabled' : 'page-item'">
								<a
									th:href="@{'/categories/page/1' + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + ${keyword != null ? '&keyword=' + keyword : ''}}"
									class="page-link">First</a>
							</li>
							<li th:class="${currentPage == 1} ? 'page-item disabled' : 'page-item'">
								<a
									th:href="@{'/categories/page/' + ${currentPage - 1} + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + ${keyword != null ? '&keyword=' + keyword : ''}}"
									class="page-link">Prev</a>
							</li>
							<li th:class="${currentPage != i} ? 'page-item' : 'page-item active'"
								th:each="i : ${#numbers.sequence(1, totalPages)}">
								<a
									th:href="@{'/categories/page/' + ${i} + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + ${keyword != null ? '&keyword=' + keyword : ''}}"
									class="page-link">[[${i}]]</a>
							</li>
							<li th:class="${currentPage == totalPages} ? 'page-item disabled' : 'page-item'">
								<a
									th:href="@{'/categories/page/' + ${currentPage + 1} + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + ${keyword != null ? '&keyword=' + keyword : ''}}"
									class="page-link">Next</a>
							</li>
							<li th:class="${currentPage == totalPages} ? 'page-item disabled' : 'page-item'">
								<a
									th:href="@{'/categories/page/' + ${totalPages} + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + ${keyword != null ? '&keyword=' + keyword : ''}}"
									class="page-link">Last</a>
							</li>
						</ul>
					</nav>
				</div>
			</div>
			<div class="modal fade" tabindex="-1" id="confirmModal">
				<div class="modal-dialog modal-fullscreen-sm-down">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="modalTitle">Delete Confirmation</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body text-center">
							<span id="confirmText">Are you sure you want to delete category with ID </span>
						</div>
						<div class="modal-footer">
							<a class="btn btn-success" href="" id="yesBtn">Yes</a>
							<button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>
						</div>
					</div>
				</div>
			</div>
			<div th:replace="~{layout :: footer}"></div>
		</div>
	<th:block th:replace="~{layout :: scripts}"></th:block>
	<script type="text/javascript">
		$(document).ready(function () {
			$('.link-delete').on('click', function (e) {
				e.preventDefault(); // prevent the default behavior of link

				link = $(this);
				catId = link.attr('catId');
				$('#yesBtn').attr('href', link.attr('href'));
				$('#confirmText').text('Are you sure you want to delete this category ID: ' + categoryId + "?");
				$('#confirmModal').modal('show');
			});
		});

		function clearFilter() {
			window.location = "[[@{/categories}]]";
		}
    </script>
</body>
</html>